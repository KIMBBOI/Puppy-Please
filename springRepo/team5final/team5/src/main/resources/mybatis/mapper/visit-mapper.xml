<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="VisitMapper">

	<!--방문예약 목록 조회 -->
	<select id="list" resultType="com.kh.app.visit.vo.VisitVo">
		SELECT
			VISIT_NO
			,MEMBER_NO
			,RESERVATION_STATUS_NO
			,RESERVATION_DATE
			,SUMMIT_DATE
			,MODIFY_DATE
			,DEL_YN
		FROM 
			VISIT_RESERVATION
		WHERE 
			DEL_YN = 'N'
			AND RESERVATION_STATUS_NO = 1
			AND TRUNC(RESERVATION_DATE) = TRUNC(TO_DATE(#{reservationDate}, 'DD/MM/YY HH24:MI:SS'))
		ORDER BY 
			RESERVATION_DATE ASC
	</select>
	
	<!--방문예약 상세 조회 -->
	<select id="detail" resultType="com.kh.app.visit.vo.VisitVo">
		SELECT
			VISIT_NO
			,MEMBER_NO
			,RESERVATION_STATUS_NO
			,RESERVATION_DATE
			,SUMMIT_DATE
			,MODIFY_DATE
			,DEL_YN
		FROM 
			VISIT_RESERVATION
		WHERE 
			VISIT_NO = #{visitNo}
	</select>
	
	<!--방문예약 작성 -->
	<insert id="insert">
		INSERT INTO VISIT_RESERVATION
		(
			VISIT_NO
			,MEMBER_NO
			,RESERVATION_STATUS_NO
			,RESERVATION_DATE
		) 
		VALUES
		(
			SEQ_VISIT_RESERVATION_NO.NEXTVAL 
			,#{memberNo}
			,'1'
			,TO_DATE(#{reservationDate},'YYYY-MM-DD')
		)
	</insert>
	
	<!--방문예약 수정 -->
	<update id="edit">
		UPDATE 
			VISIT_RESERVATION
	    SET
	        RESERVATION_DATE = #{reservationDate}
	        ,MODIFY_DATA = SYSDATE
	    WHERE
	        VISIT_NO = #{visitNo}
	</update>
	
	<!--방문예약 취소/삭제 -->
	<update id="quit">
		UPDATE 
			VISIT_RESERVATION
	    SET
	        DEL_YN = 'Y'
	        ,RESERVATION_STAYUS_NO = 3
	    WHERE 
	    	REPORT_NO = #{reportNo}
	</update>

	<!--방문예약 완료/삭제 -->
	<update id="complete">
		UPDATE 
			VISIT_RESERVATION
	    SET
	        DEL_YN = 'Y'
	        ,RESERVATION_STAYUS_NO = 2
	    WHERE 
	    	REPORT_NO = #{reportNo}
	</update>
	
</mapper>