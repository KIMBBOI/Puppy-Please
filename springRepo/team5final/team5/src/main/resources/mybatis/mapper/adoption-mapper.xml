<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AdoptionMapper">

    <!-- 입양 신청 리스트 조회 -->
    <select id="list" resultType="com.kh.app.adoption.vo.AdoptionVo">
    	SELECT *
    	FROM (
	        SELECT
		    RD.IMAGE_NO AS DOG_IMAGE_NO,
		    RD.DOG_NAME,
		    RD.BREED,
		    RD.GENDER_MF,
		    RD.NEUTERING_OX,
		    RD.AGE,
		    RD.WEIGHT
		FROM
		    ADOPTION_BOARD A
		JOIN
		    RESCUE_DOG RD ON A.RESCUE_DOG_NO = RD.RESCUE_DOG_NO
		WHERE
		    A.DEL_YN = 'N'
		ORDER BY
		    A.ENROLL_DATE DESC
    	)
    </select>

    <!-- 입양 신청 상세 조회 -->
    <select id="detail" resultType="com.kh.app.adoption.vo.AdoptionVo">
        SELECT 
        	ADOPTION_BOARD_NO
        	, IMAGE_NO
        	, RESCUE_DOG_NO
        	, ADMIN_NO
        	, ENROLL_DATE
        	, MODIFY_DATE
        	, DEL_YN
        FROM 
        	ADOPTION_BOARD
        WHERE 
        	ADOPTION_BOARD_NO = #{adoptionNo}
    </select>
    
    <!-- 게시글 작성 -->
    <insert id="write" >
		INSERT INTO ADOPTION_BOARD
        (
            ADOPTION_BOARD_NO
            , IMAGE_NO
            , RESCUE_DOG_NO
            , ADMIN_NO
        )
        VALUES
        (
            SEQ_ADOPTION_BOARD_NO.NEXTVAL
            , #{imageNo}
            , #{rescueDogNo}
            , #{adminNo}
        ) 
	</insert>

    <!-- 이미지 업로드 -->
    <insert id="insert">
    	INSERT INTO IMAGE
		(
			IMAGE_NO
			,IMAGE_PATH
		)
		VALUES
		(
			SEQ_IMAGE_NO.NEXTVAL
			,#{imagePath}
		)
    </insert>
   
	<!-- 이미지 시퀀스 가져오는 쿼리문  -->
	<select id="imageSeqNo"  resultType="java.lang.String">
		SELECT 
			SEQ_IMAGE_NO.CURRVAL
		FROM 
			DUAL
	</select>

    <!-- 입양 신청 수정 -->
    <update id="edit" parameterType="com.kh.app.adoption.vo.AdoptionVo">
        UPDATE ADOPTION_BOARD
        SET 
        	IMAGE_NO = #{imageNo},
            RESCUE_DOG_NO = #{rescueDogNo},
            ADMIN_NO = #{adminNo},
            ENROLL_DATE = #{enrollDate},
            MODIFY_DATE = #{modifyDate},
            DEL_YN = #{delYn}
        WHERE 
        	ADOPTION_BOARD_NO = #{adoptionNo}
    </update>

    <!-- 입양 신청 삭제 -->
    <update id="delete">
        UPDATE ADOPTION_BOARD
        SET 
        	DEL_YN = 'Y'
        WHERE 
        	ADOPTION_BOARD_NO = #{adoptionNo}
    </update>

</mapper>

